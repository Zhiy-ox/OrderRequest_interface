<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Submit Order Request</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
  <div class="container py-5">
    <div class="row">
      <div class="col-md-8 offset-md-2 col-lg-6 offset-lg-3">
        <div class="card shadow">
          <div class="card-body">
            <h3 class="card-title mb-4 text-center">Submit Your Order Request</h3>
            <form id="orderForm">
              <div id="itemsContainer">
                <div class="item mb-3">
                  <!-- Materials_or_Equipment_Name -->
                  <div class="mb-3">
                    <label for="Materials_or_Equipment_Name" class="form-label">Materials or Equipment Name</label>
                    <input type="text" class="form-control" name="Materials_or_Equipment_Name" placeholder="e.g., E7, BL006, etc." required />
                  </div>

                  <!-- Quantity -->
                  <div class="mb-3">
                    <label for="Quantity" class="form-label">Quantity</label>
                    <input type="number" class="form-control" name="Quantity" placeholder="e.g., 10" required />
                  </div>

                  <!-- Unit -->
                  <div class="mb-3">
                    <label for="Unit" class="form-label">Unit</label>
                    <input type="text" class="form-control" name="Unit" placeholder="e.g., g, pcs, etc." />
                  </div>

                  <!-- Proposal -->
                  <div class="mb-3">
                    <label for="Proposal" class="form-label">Proposal</label>
                    <textarea class="form-control" name="Proposal" rows="3" placeholder="Short justification or proposal"></textarea>
                  </div>

                  <!-- Link_of_Materials_or_Equipment -->
                  <div class="mb-3">
                    <label for="Link_of_Materials_or_Equipment" class="form-label">Link of Materials or Equipment</label>
                    <input type="text" class="form-control" name="Link_of_Materials_or_Equipment" placeholder="e.g., https://supplier.com/product" />
                  </div>

                  <!-- The_Order_Tracking_URL -->
                  <div class="mb-3">
                    <label for="The_Order_Tracking_URL" class="form-label">Order Tracking URL</label>
                    <input type="text" class="form-control" name="The_Order_Tracking_URL" placeholder="e.g., https://tracking.com/order/123" />
                  </div>

                  <!-- Order_submitted_Time -->
                  <div class="mb-3">
                    <label for="Order_submitted_Time" class="form-label">Order Submitted Time</label>
                    <input type="datetime-local" class="form-control" name="Order_submitted_Time" />
                  </div>
                </div>
              </div>

              <button type="button" id="addItem" class="btn btn-secondary w-100 mb-3">Add Another Item</button>
              <button type="submit" class="btn btn-primary w-100">Submit</button>
            </form>
            <div id="responseMessage" class="mt-3" style="min-height: 1.5em;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const CREATE_ITEM_FLOW_URL = "https://prod-168.westeurope.logic.azure.com:443/workflows/0d2ecc042a8745f58b40ae8e35cdc47b/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=am6h8CwzxHZWuBRAmtmhVTdaUVkBihbJP7X4LWsV3Xo";

    const orderForm = document.getElementById("orderForm");
    const itemsContainer = document.getElementById("itemsContainer");
    const addItemButton = document.getElementById("addItem");

    // Add a new item row
    addItemButton.addEventListener("click", () => {
      const newItem = document.querySelector(".item").cloneNode(true);
      newItem.querySelectorAll("input, textarea").forEach((input) => {
        input.value = ""; // Clear values for new row
      });
      itemsContainer.appendChild(newItem);
    });

    // Handle form submission
    orderForm.addEventListener("submit", async (event) => {
      event.preventDefault();

      // Collect all items into an array
      const items = [];
      itemsContainer.querySelectorAll(".item").forEach((item) => {
        const data = {};
        item.querySelectorAll("input, textarea").forEach((input) => {
          data[input.name] = input.value;
        });
        items.push(data);
      });

      // Send data to Power Automate
      try {
        const response = await fetch(CREATE_ITEM_FLOW_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ value: items }),
        });

        if (response.ok) {
          document.getElementById("responseMessage").textContent =
            "Order(s) successfully submitted.";
          orderForm.reset();
          itemsContainer.innerHTML = ""; // Clear all rows
          itemsContainer.appendChild(document.querySelector(".item").cloneNode(true)); // Keep one blank row
        } else {
          document.getElementById("responseMessage").textContent =
            "Error submitting order(s). Please try again.";
        }
      } catch (error) {
        console.error("Error:", error);
        document.getElementById("responseMessage").textContent =
          "An unexpected error occurred. Please try again.";
      }
    });
  </script>
</body>
</html>
